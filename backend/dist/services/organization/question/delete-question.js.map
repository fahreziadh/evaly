{"version":3,"sources":["../../../../src/services/organization/question/delete-question.ts"],"names":["deleteQuestion","questionId","currentQuestionOrder","db","fields","operators","question","eq","sql","and","ne","gte"],"mappings":"kIAIA,eAAsBA,CAAeC,CAAAA,CAAAA,CAAoB,CACvD,MAAMC,CACJ,CAAA,CAAA,MAAMC,CAAG,CAAA,KAAA,CAAM,SAAS,SAAU,CAAA,CAChC,OAAS,CAAA,CACP,KAAO,CAAA,IACT,CACA,CAAA,KAAA,CAAMC,CAAQC,CAAAA,CAAAA,CAAW,CACvB,OAAOA,CAAU,CAAA,EAAA,CAAGD,EAAO,EAAIH,CAAAA,CAAU,CAC3C,CACF,CAAC,CAAA,GACA,KAEGD,CAAAA,CAAAA,CAAiB,MAAMG,CAAAA,CAC1B,MAAOG,CAAAA,QAAQ,CACf,CAAA,GAAA,CAAI,CAAE,SAAW,CAAA,IAAI,IAAK,EAAA,CAAE,WAAY,EAAE,CAAC,CAC3C,CAAA,KAAA,CAAMC,EAAGD,CAAAA,QAAAA,CAAS,EAAIL,CAAAA,CAAU,CAAC,CACjC,CAAA,SAAA,EAGCD,CAAAA,CAAAA,CAAe,CAAC,CAAA,EAAKE,CACvB,EAAA,MAAMC,CACH,CAAA,MAAA,CAAOG,QAAQ,CAAA,CACf,GAAI,CAAA,CAAE,MAAOE,GAAMF,CAAAA,EAAAA,QAAAA,CAAS,KAAK,CAAA,IAAA,CAAO,CAAC,CAAA,CACzC,KACCG,CAAAA,GAAAA,CACEF,EAAGD,CAAAA,QAAAA,CAAS,WAAaN,CAAAA,CAAAA,CAAe,CAAC,CAAA,CAAE,WAAW,CACtDU,CAAAA,EAAAA,CAAGJ,QAAS,CAAA,EAAA,CAAIL,CAAU,CAAA,CAC1BU,GAAIL,CAAAA,QAAAA,CAAS,KAAOJ,CAAAA,CAAoB,CAC1C,CACF,EAEN","file":"delete-question.js","sourcesContent":["import db from \"../../../lib/db\";\nimport { question } from \"../../../lib/db/schema/question\";\nimport { and, eq, gte, ne, sql } from \"drizzle-orm\";\n\nexport async function deleteQuestion(questionId: string) {\n  const currentQuestionOrder = (\n    await db.query.question.findFirst({\n      columns: {\n        order: true,\n      },\n      where(fields, operators) {\n        return operators.eq(fields.id, questionId);\n      },\n    })\n  )?.order;\n\n  const deleteQuestion = await db\n    .update(question)\n    .set({ deletedAt: new Date().toISOString() })\n    .where(eq(question.id, questionId))\n    .returning();\n\n  // Change the order of the questions\n  if (deleteQuestion[0] && currentQuestionOrder) {\n    await db\n      .update(question)\n      .set({ order: sql`${question.order} - 1` })\n      .where(\n        and(\n          eq(question.referenceId, deleteQuestion[0].referenceId),\n          ne(question.id, questionId),\n          gte(question.order, currentQuestionOrder)\n        )\n      );\n  }\n}\n"]}