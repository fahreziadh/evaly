import{W as h,h as p,g as r,r as w,j as t,B as u,f as g,k as f,c as j,X as y,Y as I,N as A,i as v,V as N}from"./main-DlyImwyW.js";import{u as b,A as D}from"./navbar.lobby-DTd8wraj.js";import{D as T,a as B}from"./dropdown-menu-sOts507K.js";import{T as C}from"./text-shimmer-CdH4dyHN.js";import{T as S}from"./textarea-OnLNa8_E.js";import{D as Q,a as _,b as k,c as L,d as Y,e as $,f as F,g as M}from"./dialog-BkomBEYl.js";import"./logo-cIRsNJyn.js";import"./index-D8u25tJ8.js";import"./index-cFAMEy_e.js";import"./index-D1zo_IBC.js";import"./index-CDpRp4ge.js";import"./Combination-CBwBOCap.js";import"./index-CC5cL3zt.js";import"./proxy-dXJD4cHT.js";import"./x-DetwzAZJ.js";const P=({user:e})=>{const{attemptId:n,testId:s}=h({from:"/(participant)/s/$testId/$attemptId"}),i=p(r.participant.testAttempt.getById,{id:n}),{updateData:o}=b(s,e._id,{});return w.useEffect(()=>{i&&o({data:{testId:s,testSectionId:i.testSectionId}})},[i]),t.jsxs("div",{className:"flex flex-row justify-between h-14 px-4 w-full",children:[t.jsx("div",{className:"flex flex-row items-start pt-2 gap-2",children:t.jsx(O,{})}),t.jsx("div",{className:"flex flex-row items-center gap-2",children:t.jsx(D,{user:e})})]})},O=()=>{var a;const{testId:e,attemptId:n}=h({from:"/(participant)/s/$testId/$attemptId"}),s=p(r.participant.testAttempt.getById,{id:n}),i=p(r.participant.testSection.getByTestId,{testId:e}),o=s==null?void 0:s.testSectionId;return i===void 0?t.jsx(C,{children:"Loading..."}):i.length===1?null:t.jsx(T,{children:t.jsx(B,{asChild:!0,children:t.jsx(u,{variant:"outline",children:((a=i==null?void 0:i.find(l=>l._id===o))==null?void 0:a.title)||"Section 1"})})})},q=({question:e,answers:n,attemptId:s,testId:i})=>{var l;const o=g(r.participant.testAttemptAnswer.setAnswer).withOptimisticUpdate((d,c)=>{const m=d.getQuery(r.participant.testAttemptAnswer.getByAttemptId,{testAttemptId:s});m&&d.setQuery(r.participant.testAttemptAnswer.getByAttemptId,{testAttemptId:s},m.map(x=>x.questionId===e._id?{...x,...c}:x))}),a=({answerOptions:d,answerText:c})=>{o({testAttemptId:s,testSectionId:e.referenceId,questionId:e._id,answerOptions:d,answerText:c,testId:i})};return t.jsxs("div",{children:[t.jsxs("div",{className:"flex flex-row justify-between items-center",children:[t.jsxs("span",{className:"text-sm text-muted-foreground mb-1",children:["Question ",e.order]}),t.jsx("span",{className:" text-sm text-muted-foreground flex flex-row gap-2 items-center"})]}),t.jsx("div",{className:"custom-prose max-w-none lg:prose-lg",dangerouslySetInnerHTML:{__html:e.question??"No question found"}}),e.type==="multiple-choice"||e.type==="yes-or-no"?t.jsx("div",{className:"flex flex-col mt-4 gap-3",children:(l=e.options)==null?void 0:l.map(d=>{var c;return t.jsx("button",{onClick:()=>a({answerOptions:[d.id]}),className:f("max-w-full w-max h-auto border rounded-md py-1 px-3 text-start  transition-all",(c=n==null?void 0:n.answerOptions)!=null&&c.includes(d.id)?"border-primary bg-secondary ":"border-border hover:border-primary/50 active:border-primary active:bg-primary/5"),children:t.jsx("div",{className:f("custom-prose prose-sm max-w-full text-ellipsis"),dangerouslySetInnerHTML:{__html:d.text??"No option found"}})},d.id)})}):null,e.type==="text-field"?t.jsx("div",{className:"flex flex-col gap-3 mt-8",children:t.jsx(S,{className:"resize-none lg:text-base p-4",placeholder:"Type your answer here..."})}):null]})};function nt(){const e=p(r.participant.profile.getProfile);return e===void 0?t.jsx(j,{}):e===null?y():t.jsxs("div",{className:"pb-10",children:[t.jsx(P,{user:e}),t.jsx(E,{}),t.jsx(H,{})]})}const E=()=>{const{attemptId:e,testId:n}=I.useParams(),s=p(r.participant.testAttempt.getById,{id:e}),i=p(r.participant.testAttemptAnswer.getByAttemptId,{testAttemptId:e});return s===void 0?t.jsx(j,{}):s===null?t.jsx(A,{}):s.questions.length===0?t.jsx("div",{className:"container mt-12 flex flex-col gap-12 max-w-[1000px] font-medium text-lg",children:"No questions found"}):t.jsx("div",{className:"container mt-12 flex flex-col gap-12 max-w-[1000px]",children:s.questions.map(o=>t.jsx(q,{question:o,attemptId:e,answers:i==null?void 0:i.find(a=>a.questionId===o._id),testId:n},o._id))})},H=()=>{const{attemptId:e}=I.useParams(),n=v(),s=p(r.participant.testAttempt.getById,{id:e}),i=p(r.participant.testAttemptAnswer.getByAttemptId,{testAttemptId:e}),o=g(r.participant.testAttempt.finish).withOptimisticUpdate(c=>{const m=c.getQuery(r.participant.testAttempt.getById,{id:e});m&&c.setQuery(r.participant.testAttempt.getById,{id:e},{...m,finishedAt:Date.now()})}),a=s==null?void 0:s.questions.length,l=i==null?void 0:i.length,d=(s==null?void 0:s.finishedAt)!==void 0;return t.jsxs("div",{className:"container max-w-[1000px] mt-14 border-dashed flex flex-col gap-2 border border-primary/30 rounded-md bg-background shadow-xl shadow-primary/5 p-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:a===l?"You have answered all the questions":"You have answered "+l+" out of "+a+" questions"}),d?t.jsxs(u,{variant:"outline",onClick:()=>n({to:"/s/$testId",params:{testId:s==null?void 0:s.testId}}),className:"w-max",children:[t.jsx(N,{}),"Back to test"]}):t.jsxs(Q,{children:[t.jsx(_,{asChild:!0,children:t.jsx(u,{className:"w-max px-4",variant:a===l?"default":"outline",children:"Submit"})}),t.jsxs(k,{children:[t.jsxs(L,{children:[t.jsx(Y,{children:"Are you sure you want to submit the test?"}),t.jsx($,{children:a===l?"You have answered all the questions":"You have answered "+l+" out of "+a+" questions"})]}),t.jsxs(F,{children:[t.jsx(M,{asChild:!0,children:t.jsx(u,{variant:"outline",children:"Cancel"})}),t.jsx(u,{onClick:()=>o({id:e}).finally(()=>{n({to:"/s/$testId",params:{testId:s==null?void 0:s.testId}})}),children:"Yes, submit"})]})]})]})]})};export{nt as component};
