{"version":3,"sources":["../../../../src/services/organization/organizer/get-selected-organizer-byuserid.ts"],"names":["getSelectedOrganizerByUserId","userId","userWithSelectedOrganizer","db","fields","operators","firstFoundOrganizer","setSelectedOrganizer"],"mappings":"2FAGA,eAAsBA,EAA6BC,CAAgB,CAAA,CACjE,MAAMC,CAA4B,CAAA,MAAMC,EAAG,KAAM,CAAA,IAAA,CAAK,UAAU,CAC9D,IAAA,CAAM,CACJ,iBAAmB,CAAA,CACjB,KAAM,CACJ,YAAA,CAAc,IAChB,CACF,CACF,EACA,KAAMC,CAAAA,CAAAA,CAAQC,EAAW,CACvB,OAAOA,EAAU,EAAGD,CAAAA,CAAAA,CAAO,GAAIH,CAAM,CACvC,CACF,CAAC,CAAA,CAGD,GAAIC,CAAAA,EAA2B,iBAC7B,CAAA,OAAOA,GAA2B,iBAIpC,CAAA,MAAMI,EAAsB,MAAMH,CAAAA,CAAG,MAAM,SAAU,CAAA,SAAA,CAAU,CAC7D,IAAM,CAAA,CACJ,aAAc,IAChB,CAAA,CACA,QAAQC,CAAQC,CAAAA,CAAAA,CAAW,CACzB,OAAOA,CAAAA,CAAU,IAAKD,CAAAA,CAAAA,CAAO,SAAS,CACxC,EACA,KAAMA,CAAAA,CAAAA,CAAQC,EAAW,CACvB,OAAOA,EAAU,EAAGD,CAAAA,CAAAA,CAAO,OAAQH,CAAM,CAC3C,CACF,CAAC,CAAA,CAED,GAAIK,CACF,CAAA,OAAA,MAAMC,qBAAqBN,CAAQK,CAAAA,CAAAA,CAAoB,EAAE,CAAA,CAClDA,CAIX","file":"get-selected-organizer-byuserid.js","sourcesContent":["import db from \"../../../lib/db\";\nimport { setSelectedOrganizer } from \"./set-selected-organizer\";\n\nexport async function getSelectedOrganizerByUserId(userId: string) {\n  const userWithSelectedOrganizer = await db.query.user.findFirst({\n    with: {\n      selectedOrganizer: {\n        with: {\n          organization: true,\n        },\n      },\n    },\n    where(fields, operators) {\n      return operators.eq(fields.id, userId);\n    },\n  });\n\n  // If there is a selected organizer by a user, just return it\n  if (userWithSelectedOrganizer?.selectedOrganizer) {\n    return userWithSelectedOrganizer?.selectedOrganizer;\n  }\n\n  // If there is no selected organizer, find the first organizer available and update to user data with selected organizer\n  const firstFoundOrganizer = await db.query.organizer.findFirst({\n    with: {\n      organization: true,\n    },\n    orderBy(fields, operators) {\n      return operators.desc(fields.createdAt);\n    },\n    where(fields, operators) {\n      return operators.eq(fields.userId, userId);\n    },\n  });\n\n  if (firstFoundOrganizer) {\n    await setSelectedOrganizer(userId, firstFoundOrganizer.id);\n    return firstFoundOrganizer;\n  }\n\n  return undefined;\n}\n"]}