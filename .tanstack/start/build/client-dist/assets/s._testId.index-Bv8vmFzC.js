var gt=e=>{throw TypeError(e)};var tt=(e,t,s)=>t.has(e)||gt("Cannot "+s);var i=(e,t,s)=>(tt(e,t,"read from private field"),s?s.call(e):t.get(e)),v=(e,t,s)=>t.has(e)?gt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),f=(e,t,s,n)=>(tt(e,t,"write to private field"),n?n.call(e,s):t.set(e,s),s),m=(e,t,s)=>(tt(e,t,"access private method"),s);import{d as _t,S as Nt,p as bt,q as j,s as et,v as z,w as st,x as it,y as yt,z as kt,A as Dt,D as Ut,E as Rt,F as Ot,r as w,G as Lt,I as Mt,h as Et,g as U,J as Bt,K as ut,j as r,c as Pt,N as At,i as Ht,f as Vt,B as J,C as zt,t as $t,M as Wt}from"./main-DlyImwyW.js";import{N as Kt}from"./navbar.lobby-DTd8wraj.js";import{B as F}from"./badge-DCUqPuCj.js";import{t as qt}from"./test-type-formatter-DQ-TJDsf.js";import{C as Gt}from"./circle-check-big-YQr7ENWC.js";import{F as Jt}from"./file-text-BOTRp_Gg.js";import{C as Ct}from"./check-Co2yzWpo.js";import{C as jt}from"./chart-column-CtU1n1rk.js";import{L as Xt}from"./lock-B3FKnUJT.js";import"./logo-cIRsNJyn.js";import"./index-D8u25tJ8.js";import"./index-cFAMEy_e.js";import"./index-D1zo_IBC.js";import"./dropdown-menu-sOts507K.js";import"./index-CDpRp4ge.js";import"./Combination-CBwBOCap.js";import"./index-CC5cL3zt.js";import"./dialog-BkomBEYl.js";import"./x-DetwzAZJ.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]],Zt=_t("file-search",Yt);var y,c,$,g,_,L,O,E,W,M,B,N,k,Q,P,l,V,rt,nt,at,ot,ht,ct,lt,Qt,Tt,te=(Tt=class extends Nt{constructor(t,s){super();v(this,l);v(this,y);v(this,c);v(this,$);v(this,g);v(this,_);v(this,L);v(this,O);v(this,E);v(this,W);v(this,M);v(this,B);v(this,N);v(this,k);v(this,Q);v(this,P,new Set);this.options=s,f(this,y,t),f(this,E,null),f(this,O,bt()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,c).addObserver(this),It(i(this,c),this.options)?m(this,l,V).call(this):this.updateResult(),m(this,l,ot).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return dt(i(this,c),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return dt(i(this,c),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,m(this,l,ht).call(this),m(this,l,ct).call(this),i(this,c).removeObserver(this)}setOptions(t){const s=this.options,n=i(this,c);if(this.options=i(this,y).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof j(this.options.enabled,i(this,c))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");m(this,l,lt).call(this),i(this,c).setOptions(this.options),s._defaulted&&!et(this.options,s)&&i(this,y).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,c),observer:this});const o=this.hasListeners();o&&St(i(this,c),n,this.options,s)&&m(this,l,V).call(this),this.updateResult(),o&&(i(this,c)!==n||j(this.options.enabled,i(this,c))!==j(s.enabled,i(this,c))||z(this.options.staleTime,i(this,c))!==z(s.staleTime,i(this,c)))&&m(this,l,rt).call(this);const a=m(this,l,nt).call(this);o&&(i(this,c)!==n||j(this.options.enabled,i(this,c))!==j(s.enabled,i(this,c))||a!==i(this,Q))&&m(this,l,at).call(this,a)}getOptimisticResult(t){const s=i(this,y).getQueryCache().build(i(this,y),t),n=this.createResult(s,t);return se(this,n)&&(f(this,g,n),f(this,L,this.options),f(this,_,i(this,c).state)),n}getCurrentResult(){return i(this,g)}trackResult(t,s){return new Proxy(t,{get:(n,o)=>(this.trackProp(o),s==null||s(o),o==="promise"&&!this.options.experimental_prefetchInRender&&i(this,O).status==="pending"&&i(this,O).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(n,o))})}trackProp(t){i(this,P).add(t)}getCurrentQuery(){return i(this,c)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=i(this,y).defaultQueryOptions(t),n=i(this,y).getQueryCache().build(i(this,y),s);return n.fetch().then(()=>this.createResult(n,s))}fetch(t){return m(this,l,V).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,g)))}createResult(t,s){var vt;const n=i(this,c),o=this.options,a=i(this,g),d=i(this,_),I=i(this,L),b=t!==n?t.state:i(this,$),{state:u}=t;let h={...u},T=!1,p;if(s._optimisticResults){const C=this.hasListeners(),q=!C&&It(t,s),D=C&&St(t,n,s,o);(q||D)&&(h={...h,...Ut(u.data,t.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:A,errorUpdatedAt:H,status:R}=h;p=h.data;let K=!1;if(s.placeholderData!==void 0&&p===void 0&&R==="pending"){let C;a!=null&&a.isPlaceholderData&&s.placeholderData===(I==null?void 0:I.placeholderData)?(C=a.data,K=!0):C=typeof s.placeholderData=="function"?s.placeholderData((vt=i(this,B))==null?void 0:vt.state.data,i(this,B)):s.placeholderData,C!==void 0&&(R="success",p=Rt(a==null?void 0:a.data,C,s),T=!0)}if(s.select&&p!==void 0&&!K)if(a&&p===(d==null?void 0:d.data)&&s.select===i(this,W))p=i(this,M);else try{f(this,W,s.select),p=s.select(p),p=Rt(a==null?void 0:a.data,p,s),f(this,M,p),f(this,E,null)}catch(C){f(this,E,C)}i(this,E)&&(A=i(this,E),p=i(this,M),H=Date.now(),R="error");const X=h.fetchStatus==="fetching",Y=R==="pending",Z=R==="error",mt=Y&&X,xt=p!==void 0,S={status:R,fetchStatus:h.fetchStatus,isPending:Y,isSuccess:R==="success",isError:Z,isInitialLoading:mt,isLoading:mt,data:p,dataUpdatedAt:h.dataUpdatedAt,error:A,errorUpdatedAt:H,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>b.dataUpdateCount||h.errorUpdateCount>b.errorUpdateCount,isFetching:X,isRefetching:X&&!Y,isLoadingError:Z&&!xt,isPaused:h.fetchStatus==="paused",isPlaceholderData:T,isRefetchError:Z&&xt,isStale:ft(t,s),refetch:this.refetch,promise:i(this,O),isEnabled:j(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const C=G=>{S.status==="error"?G.reject(S.error):S.data!==void 0&&G.resolve(S.data)},q=()=>{const G=f(this,O,S.promise=bt());C(G)},D=i(this,O);switch(D.status){case"pending":t.queryHash===n.queryHash&&C(D);break;case"fulfilled":(S.status==="error"||S.data!==D.value)&&q();break;case"rejected":(S.status!=="error"||S.error!==D.reason)&&q();break}}return S}updateResult(){const t=i(this,g),s=this.createResult(i(this,c),this.options);if(f(this,_,i(this,c).state),f(this,L,this.options),i(this,_).data!==void 0&&f(this,B,i(this,c)),et(s,t))return;f(this,g,s);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,a=typeof o=="function"?o():o;if(a==="all"||!a&&!i(this,P).size)return!0;const d=new Set(a??i(this,P));return this.options.throwOnError&&d.add("error"),Object.keys(i(this,g)).some(I=>{const x=I;return i(this,g)[x]!==t[x]&&d.has(x)})};m(this,l,Qt).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&m(this,l,ot).call(this)}},y=new WeakMap,c=new WeakMap,$=new WeakMap,g=new WeakMap,_=new WeakMap,L=new WeakMap,O=new WeakMap,E=new WeakMap,W=new WeakMap,M=new WeakMap,B=new WeakMap,N=new WeakMap,k=new WeakMap,Q=new WeakMap,P=new WeakMap,l=new WeakSet,V=function(t){m(this,l,lt).call(this);let s=i(this,c).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(st)),s},rt=function(){m(this,l,ht).call(this);const t=z(this.options.staleTime,i(this,c));if(it||i(this,g).isStale||!yt(t))return;const n=kt(i(this,g).dataUpdatedAt,t)+1;f(this,N,setTimeout(()=>{i(this,g).isStale||this.updateResult()},n))},nt=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,c)):this.options.refetchInterval)??!1},at=function(t){m(this,l,ct).call(this),f(this,Q,t),!(it||j(this.options.enabled,i(this,c))===!1||!yt(i(this,Q))||i(this,Q)===0)&&f(this,k,setInterval(()=>{(this.options.refetchIntervalInBackground||Dt.isFocused())&&m(this,l,V).call(this)},i(this,Q)))},ot=function(){m(this,l,rt).call(this),m(this,l,at).call(this,m(this,l,nt).call(this))},ht=function(){i(this,N)&&(clearTimeout(i(this,N)),f(this,N,void 0))},ct=function(){i(this,k)&&(clearInterval(i(this,k)),f(this,k,void 0))},lt=function(){const t=i(this,y).getQueryCache().build(i(this,y),this.options);if(t===i(this,c))return;const s=i(this,c);f(this,c,t),f(this,$,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Qt=function(t){Ot.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(i(this,g))}),i(this,y).getQueryCache().notify({query:i(this,c),type:"observerResultsUpdated"})})},Tt);function ee(e,t){return j(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function It(e,t){return ee(e,t)||e.state.data!==void 0&&dt(e,t,t.refetchOnMount)}function dt(e,t,s){if(j(t.enabled,e)!==!1&&z(t.staleTime,e)!=="static"){const n=typeof s=="function"?s(e):s;return n==="always"||n!==!1&&ft(e,t)}return!1}function St(e,t,s,n){return(e!==t||j(n.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&ft(e,s)}function ft(e,t){return j(t.enabled,e)!==!1&&e.isStaleByTime(z(t.staleTime,e))}function se(e,t){return!et(e.getCurrentResult(),t)}var Ft=w.createContext(!1),ie=()=>w.useContext(Ft);Ft.Provider;function re(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var ne=w.createContext(re()),ae=()=>w.useContext(ne),oe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},he=e=>{w.useEffect(()=>{e.clearReset()},[e])},ce=({result:e,errorResetBoundary:t,throwOnError:s,query:n,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(o&&e.data===void 0||Lt(s,[e.error,n])),le=(e,t)=>t.state.data===void 0,de=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),s=e.staleTime;e.staleTime=typeof s=="function"?(...n)=>t(s(...n)):t(s),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},ue=(e,t)=>e.isLoading&&e.isFetching&&!t,fe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,wt=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function pe(e,t,s){var h,T,p,A,H;const n=ie(),o=ae(),a=Mt(),d=a.defaultQueryOptions(e);(T=(h=a.getDefaultOptions().queries)==null?void 0:h._experimental_beforeQuery)==null||T.call(h,d),d._optimisticResults=n?"isRestoring":"optimistic",de(d),oe(d,o),he(o);const I=!a.getQueryCache().get(d.queryHash),[x]=w.useState(()=>new t(a,d)),b=x.getOptimisticResult(d),u=!n&&e.subscribed!==!1;if(w.useSyncExternalStore(w.useCallback(R=>{const K=u?x.subscribe(Ot.batchCalls(R)):st;return x.updateResult(),K},[x,u]),()=>x.getCurrentResult(),()=>x.getCurrentResult()),w.useEffect(()=>{x.setOptions(d)},[d,x]),fe(d,b))throw wt(d,x,o);if(ce({result:b,errorResetBoundary:o,throwOnError:d.throwOnError,query:a.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw b.error;if((A=(p=a.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||A.call(p,d,b),d.experimental_prefetchInRender&&!it&&ue(b,n)){const R=I?wt(d,x,o):(H=a.getQueryCache().get(d.queryHash))==null?void 0:H.promise;R==null||R.catch(st).finally(()=>{x.updateResult()})}return d.notifyOnChangeProps?b:x.trackResult(b)}function pt(e,t){return pe({...e,enabled:!0,suspense:!0,throwOnError:le,placeholderData:void 0},te)}function Me(){var n;const e=Et(U.participant.profile.getProfile),{testId:t}=Bt.useParams(),{data:s}=pt(ut(U.participant.test.getById,{id:t}));return s===void 0||e===void 0?r.jsx(Pt,{}):s===null||e===null?r.jsx(At,{}):r.jsxs(r.Fragment,{children:[r.jsx(Kt,{user:e}),r.jsxs("div",{className:"pb-20 mt-[5vh] md:mt-[10vh] container max-w-2xl",children:[r.jsx("h1",{className:"text-xl font-semibold mb-4",children:s.title||"Untitled Test"}),r.jsx(me,{test:s}),r.jsx(xe,{test:s}),(n=s.description)!=null&&n.replace("<p></p>","").length?r.jsxs(r.Fragment,{children:[r.jsx("h1",{className:"mt-8 font-semibold",children:"Description"}),r.jsx("div",{className:"mt-2 custom-prose",dangerouslySetInnerHTML:{__html:s.description||""}})]}):null]})]})}const me=({test:e})=>{const{data:t}=pt(ut(U.participant.testSection.getByTestId,{testId:e._id}));return r.jsx("div",{className:"flex flex-row flex-wrap",children:r.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.finishedAt?r.jsxs(F,{children:[r.jsx(Gt,{}),"Test Finished"]}):null,r.jsx(F,{variant:"secondary",children:qt(e.type)}),t&&(t==null?void 0:t.length)>1?r.jsxs(F,{variant:"secondary",children:[r.jsx(Zt,{className:"h-4 w-4 text-muted-foreground"}),r.jsxs("span",{children:[t.length," Sections"]})]}):null,r.jsxs(F,{variant:"secondary",children:[r.jsx(Jt,{className:"h-4 w-4 text-muted-foreground"}),r.jsxs("span",{children:[t==null?void 0:t.reduce((s,n)=>s+n.numOfQuestions,0)," ","Questions"]})]})]})})},xe=({test:e})=>{var b;const t=Ht(),[s,n]=w.useState(),{data:o}=pt(ut(U.participant.testSection.getByTestId,{testId:e._id})),a=Et(U.participant.testAttempt.getByTestIdAndParticipantId,{testId:e._id}),d=Vt(U.participant.testAttempt.start),I=async u=>{n(u);try{const h=await d({testSectionId:u});t({to:"/s/$testId/$attemptId",params:{testId:e._id,attemptId:h._id}})}catch(h){$t.error(h instanceof Wt?h.data:"Unknown error")}finally{n(void 0)}};if((o==null?void 0:o.length)===0)return r.jsxs("div",{className:"mt-8",children:[r.jsx("h1",{className:"font-semibold",children:"Sections"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"No sections found for this test."})]});if((o==null?void 0:o.length)===1){const u=a===void 0||((b=a==null?void 0:a.find(h=>h.testSectionId===o[0]._id))==null?void 0:b.finishedAt)!==void 0;return r.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[r.jsxs(J,{disabled:a===void 0||!!s||u,variant:"default",className:"w-max px-4 select-none",onClick:()=>I(o[0]._id),children:[s?"Starting...":null,a===void 0?"Loading...":null,a&&u?r.jsxs(r.Fragment,{children:[r.jsx(Ct,{}),"Finished"]}):null,!u&&!s&&!a?"Start Test":null,a&&!u&&!s?"Continue Test":null]}),u&&a&&r.jsxs(J,{variant:"outline",className:"w-max px-4 select-none",onClick:()=>t({to:"/s/$testId/results",params:{testId:e._id}}),children:[r.jsx(jt,{className:"mr-2 h-4 w-4"}),"View Results"]})]})}const x=o==null?void 0:o.every(u=>{const h=a==null?void 0:a.find(T=>T.testSectionId===u._id);return(h==null?void 0:h.finishedAt)!==void 0});return r.jsxs(r.Fragment,{children:[r.jsx("h1",{className:"mt-8 font-semibold",children:"Sections"}),r.jsx(zt,{className:"mt-3 divide-y",children:o==null?void 0:o.map(u=>{const h=a==null?void 0:a.find(p=>p.testSectionId===u._id),T=(h==null?void 0:h.finishedAt)!==void 0;return r.jsxs("div",{className:"px-6 py-3 hover:border-solid flex flex-row items-center hover:bg-secondary transition",children:[r.jsxs("div",{className:"flex flex-row items-center gap-2 flex-1",children:[r.jsxs("h1",{className:"font-medium text-sm",children:[u.order,". ",u.title||`Section ${u.order}`]}),r.jsxs(F,{variant:"outline",children:[u.numOfQuestions," Question",u.numOfQuestions<=1?"":"s"]})]}),r.jsx("div",{children:T?r.jsxs(F,{variant:"success",children:[r.jsx(Ct,{})," Finished"]}):e.finishedAt?r.jsx(F,{variant:"outline",children:"Test Ended"}):r.jsxs(J,{disabled:a===void 0||!!e.finishedAt||s===u._id,variant:"outline",size:"sm",className:"px-3 select-none",onClick:()=>I(u._id),children:[e.finishedAt?r.jsx(Xt,{}):null,s===u._id?"Starting...":h?"Continue":"Start"]})})]},u._id)})}),x&&a&&r.jsxs(J,{variant:"default",className:"w-max mt-4 px-4 select-none",onClick:()=>t({to:"/s/$testId/results",params:{testId:e._id}}),children:[r.jsx(jt,{className:"mr-2 h-4 w-4"}),"View Results"]})]})};export{Me as component};
